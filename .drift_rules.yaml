# Drift Rules File
# Validation rules for the Drift project
# This file is automatically loaded by drift when .drift_rules.yaml exists in the project root

# All rules are project-level focused on documentation quality
skill_completeness:
  description: "Claude Code skills missing essential components or clarity"
  scope: project_level
  context: "Incomplete skills create confusion and slow development. Skills must be self-contained with clear examples and dependencies."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: skill
    file_patterns:
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
    resource_patterns:
      - "**/*.py"
      - "**/*.js"
      - "**/*.md"
      - "**/*.ts"
  phases:
    - name: structural_quality
      type: prompt
      prompt: |
        Evaluate the skill's structural quality per Anthropic's Agent Skills best practices.

        CRITICAL ISSUES (report these):
        1. Frontmatter description COMPLETELY MISSING "when to use" or "use when" phrase
        2. Multi-page templates or large reference content dumped inline (>100 lines of template/boilerplate)
        3. Entire skill is just vague responsibilities with NO actionable instructions anywhere

        ACCEPTABLE (do NOT report):
        - Any "Use when..." phrase in frontmatter, even if brief (e.g., "Use when writing tests" is FINE)
        - Skills that start with brief intro then dive into instructions
        - "Core Responsibilities" sections IF followed by actionable content
        - References to project files/scripts (assume they exist)
        - Missing examples IF the skill content is self-explanatory

        EXAMPLES OF WHAT TO IGNORE:
        - "Use when writing or structuring issues" ✓ ACCEPTABLE
        - "Use when fixing linting errors" ✓ ACCEPTABLE
        - "Expert in X" then actionable content ✓ ACCEPTABLE

        ONLY REPORT if there's a REAL structural problem, not style nitpicks.
      available_resources:
        - skill
    - name: verify_dependencies
      type: prompt
      prompt: |
        If the skill references other skills, verify they exist by requesting them.
        Only flag missing references to actual dependency skills.
      available_resources:
        - skill
    - name: final_quality_check
      type: prompt
      prompt: |
        Review all findings from previous phases.

        ONLY report CRITICAL structural problems:
        - Missing "use when" activation criteria entirely
        - Massive content dumps (templates >100 lines inline)
        - No actionable instructions anywhere

        IGNORE minor style issues:
        - Slight wording variations in "use when" phrases
        - Brief introductory sections
        - "Core Responsibilities" if actionable content follows
      available_resources:
        - skill

skill_description_quality:
  description: "Skill descriptions must include specific trigger terms for discovery"
  scope: project_level
  context: "Skills are model-invoked (Claude autonomously decides when to use them). Descriptions must include specific trigger terms users would naturally mention to enable proper discovery. Vague descriptions prevent Claude from activating the skill when needed."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: skill
    file_patterns:
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
  phases:
    - name: check_trigger_terms
      type: prompt
      prompt: |
        Evaluate the skill frontmatter description for specific trigger terms and discovery enablement.

        CRITICAL ISSUES (report these):
        1. Description is overly vague without specific trigger terms (e.g., "Helps with coding" - what kind of coding?)
        2. Description lacks BOTH what the skill does AND when to use it (needs both capability + activation scenario)
        3. Description could match too many unrelated scenarios (overly broad causing false activations)
        4. Description uses only generic nouns without domain-specific terms (e.g., "Expert in documents" vs "Expert in PDF reports with tabular data")

        ACCEPTABLE (do NOT report):
        - Description includes "use when" or "use for" phrasing (already validated by structural check)
        - Description mentions specific technologies, frameworks, or domains (pytest, GitHub, AWS, etc.)
        - Description contains trigger terms users would naturally mention (e.g., "test coverage", "PR review", "release management")
        - Description is concise but domain-specific (brevity with specificity is ideal)

        GOOD EXAMPLES (do NOT report):
        - "Expert in writing PEP 257 compliant docstrings using Google-style format. Use when documenting Python code."
        - "Use when creating comprehensive pytest test suites with 90%+ coverage requirements"
        - "Expert in GitHub workflows including issue management and PR operations. Use when working with GitHub via MCP."

        BAD EXAMPLES (report these):
        - "Helps with code" (no specific domain or trigger terms)
        - "Use when writing" (too generic - writing what?)
        - "Expert in quality" (vague - what kind of quality?)
        - "Documentation helper" (no specificity about documentation type or use case)

        Focus: Does the description enable Claude to recognize when this skill should be activated?
      available_resources:
        - skill

agent_completeness:
  description: "Claude Code agents missing essential components or clarity"
  scope: project_level
  context: "Incomplete agents create confusion about delegation and task automation. Agents must clearly define their scope and dependencies."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: agent
    file_patterns:
      - .claude/agents/*.md
    bundle_strategy: individual
    resource_patterns: []
  phases:
    - name: workflow_quality
      type: prompt
      prompt: |
        Evaluate the agent's workflow guidance and task delegation clarity.

        CRITICAL ISSUES (report these):
        - Agent has NO purpose or scope explanation anywhere
        - Agent provides ZERO workflow guidance (doesn't explain how to approach tasks at all)
        - Agent is completely missing examples

        ACCEPTABLE (do NOT report):
        - References to MCP tools without explaining setup
        - Brief or general workflow descriptions (some guidance is better than none)
        - Agent lists responsibilities without exhaustive decision criteria
        - References to standard project scripts/tools

        ONLY REPORT if there's a REAL problem, not style nitpicks.
      available_resources:
        - agent
    - name: verify_references
      type: prompt
      prompt: |
        If the agent references other agents or skills, verify they exist by requesting them.
        Only flag missing references to actual dependency agents or skills.
      available_resources:
        - agent
        - skill
    - name: final_quality_check
      type: prompt
      prompt: |
        Review all findings from previous phases.

        ONLY report CRITICAL problems:
        - Missing workflow guidance entirely
        - No purpose/scope explanation at all
        - Completely missing examples

        IGNORE minor issues and style preferences.
      available_resources:
        - agent
        - skill

agent_description_quality:
  description: "Agent descriptions must be action-oriented and specific for effective delegation"
  scope: project_level
  context: "Agent descriptions guide Claude's automatic delegation decisions. Vague descriptions like 'helps with documents' prevent proper agent discovery and use. Action-oriented descriptions with specific trigger terms enable effective autonomous delegation."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: agent
    file_patterns:
      - .claude/agents/*.md
    bundle_strategy: individual
  phases:
    - name: check_description_quality
      type: prompt
      prompt: |
        Evaluate the agent frontmatter description for action-oriented language and specificity.

        CRITICAL ISSUES (report these):
        1. Description is overly vague or generic (e.g., "Helps with tasks", "General purpose agent", "Assists with work")
        2. Description lacks WHEN/WHAT context - doesn't indicate when agent should be used
        3. Description is just a noun phrase without action orientation (e.g., "Documentation helper" vs "Use for writing API documentation")
        4. Description could apply to multiple unrelated agents (too broad)

        ACCEPTABLE (do NOT report):
        - Description includes specific action verbs or "Use when/for" phrasing
        - Description mentions specific domains/technologies (e.g., "Python testing", "GitHub operations", "CI/CD automation")
        - Description is concise but clear about purpose (brevity is fine if specific)
        - Description uses imperative or action-oriented language

        GOOD EXAMPLES (do NOT report):
        - "Use when writing comprehensive pytest test suites with 90%+ coverage"
        - "Specialized CI/CD agent for automation and GitHub Actions workflows"
        - "Expert in maintaining code quality using flake8, black, isort"

        BAD EXAMPLES (report these):
        - "Helps with documents" (vague, no specificity)
        - "General development tasks" (too broad)
        - "Code assistant" (generic, no differentiation)
        - "Helper agent" (no actionable information)

        ONLY flag descriptions that genuinely hinder agent discovery and delegation.
      available_resources:
        - agent

command_completeness:
  description: "Claude Code commands missing essential components or clarity"
  scope: project_level
  context: "Incomplete commands miss validation steps and create workflow inefficiency. Commands must declare dependencies and provide clear execution steps."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: command
    file_patterns:
      - .claude/commands/*.md
    bundle_strategy: individual
    resource_patterns: []
  phases:
    - name: execution_clarity
      type: prompt
      prompt: |
        Evaluate the command's execution clarity and usability.

        CRITICAL ISSUES (report these):
        - Command has NO purpose explanation anywhere
        - Command provides ZERO execution guidance (no steps at all)
        - Invocation syntax completely missing or totally unclear

        ACCEPTABLE (do NOT report):
        - References to project scripts (./test.sh, ./lint.sh)
        - References to MCP tools by name
        - Parameter placeholders like <issue_number>, $ARGUMENTS
        - Brief execution steps (some guidance is better than none)
        - Missing exhaustive success criteria (nice-to-have)

        ONLY REPORT if there's a REAL problem, not style nitpicks.
      available_resources:
        - command
        - skill
        - agent
    - name: verify_dependencies
      type: prompt
      prompt: |
        If the command references other commands, skills, or agents, verify they exist.
        Only flag missing references to actual dependencies.
      available_resources:
        - command
        - skill
        - agent
    - name: final_quality_check
      type: prompt
      prompt: |
        Review all findings from previous phases.

        ONLY report CRITICAL problems:
        - Missing purpose entirely
        - Zero execution guidance
        - Completely unclear invocation

        IGNORE minor issues and style preferences.
      available_resources:
        - command
        - skill
        - agent

command_description_quality:
  description: "Command descriptions must be meaningful and actionable in /help output"
  scope: project_level
  context: "Command frontmatter descriptions appear in /help output. Users browse /help to discover available commands. Descriptions that merely repeat the filename or are overly vague don't help users understand when to use each command."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: command
    file_patterns:
      - .claude/commands/*.md
    bundle_strategy: individual
  phases:
    - name: check_description_helpfulness
      type: prompt
      prompt: |
        Evaluate the command frontmatter description for helpfulness in /help output.

        Extract the command filename (without .md extension) from the file path.

        CRITICAL ISSUES (report these):
        1. Description is just the command name repeated (e.g., file: "test.md", description: "test")
        2. Description is a single word that doesn't explain purpose (e.g., "Linting", "Testing" without context)
        3. Description is overly vague and could apply to any command (e.g., "Run checks", "Do work")
        4. Description doesn't indicate WHAT the command does or WHEN to use it

        ACCEPTABLE (do NOT report):
        - Description clearly explains what command does (e.g., "Run pytest tests with coverage reporting")
        - Description indicates when/why to use command (e.g., "Create PR with quality validation")
        - Description mentions specific tools/workflows (e.g., "Run linters and formatters (flake8, black, isort)")
        - Description is concise but informative (brevity is fine if clear)

        GOOD EXAMPLES (do NOT report):
        - For test.md: "Run pytest tests" ✓ (clear purpose)
        - For lint.md: "Run linters and formatters" ✓ (explains what)
        - For create-pr.md: "Create PR with quality validation" ✓ (action + context)

        BAD EXAMPLES (report these):
        - For test.md: "test" ✗ (just filename repetition)
        - For lint.md: "Linting" ✗ (single word, no context)
        - For work.md: "Do work" ✗ (vague, no specificity)

        Focus: Would a user browsing /help understand what this command does and when to use it?
      available_resources:
        - command

command_consistency:
  description: "Commands contradict project guidelines or each other"
  scope: project_level
  context: "Contradictory commands create confusion and workflow inefficiency. Commands must be consistent with project guidelines and declare their dependencies."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: mixed
    file_patterns:
      - .claude/commands/*.md
      - CLAUDE.md
    bundle_strategy: collection
    resource_patterns: []
  phases:
    - name: consistency_check
      type: prompt
      prompt: |
        Analyze commands for ACTUAL contradictions, not cosmetic differences.

        Project root: {project_root}
        Files: {files_with_paths}

        ONLY report if you find CONTRADICTIONS:
        1. Command A says "do X before Y", Command B says "do Y before X" (for the same task)
        2. Commands require mutually exclusive tools or conflicting workflows
        3. Commands explicitly contradict CLAUDE.md guidelines

        DO NOT REPORT (these are NOT issues):
        - All commands say "activate skills at step 1" - this is PERFECT consistency
        - All commands say "activate before proceeding" + show activation at step 1 - this is CLEAR and CONSISTENT
        - Wording variations like "MUST activate" vs "must activate" vs "Activate" - meaningless difference
        - Commands for different tasks have different workflow steps - this is EXPECTED and CORRECT
        - "before proceeding" appearing in multiple commands - this is CONSISTENCY, not inconsistency

        EXAMPLE OF REAL CONTRADICTION (report this):
        - Command A: "Activate skills before gathering info"
        - Command B: "Gather info before activating skills"

        EXAMPLE OF NON-ISSUE (DO NOT report this):
        - Command A: "MUST activate skills before proceeding. Steps: 1. Activate skills 2. Do work"
        - Command B: "MUST activate skills before proceeding. Steps: 1. Activate skills 2. Do work"
        - These are IDENTICAL behaviors with the same wording - perfectly consistent!

        If all commands follow the same activation pattern (step 1 = activate), do NOT report any issue.
      available_resources: []
    - name: pattern_consistency_check
      type: prompt
      prompt: |
        Check if similar commands follow similar patterns for skill usage.

        CRITICAL ISSUES (report these):
        1. Testing-related commands (test, full-check, create-pr) have inconsistent use of "testing" skill
           → Some declare it, others don't (should be consistent)
        2. Linting-related commands have inconsistent use of "linting" skill
        3. GitHub-related commands have inconsistent use of "github-operations" skill
        4. Similar commands use different approaches without good reason

        ACCEPTABLE (do NOT report):
        - All test-related commands use "testing" skill ✓
        - All lint-related commands use "linting" skill ✓
        - Commands for different domains use different skills ✓ (expected)
        - One-off commands don't follow a pattern ✓ (no similar commands to compare)

        EXAMPLES:

        BAD (report these):
        - Command "test" uses testing skill, but "full-check" (which runs tests) doesn't ✗
        - Command "create-pr" uses github-operations, but "work-on-issue" (also GitHub) doesn't ✗

        GOOD (do NOT report):
        - All test commands declare testing skill ✓
        - All GitHub commands declare github-operations skill ✓
        - Developer command uses different skills than QA command ✓ (different domains)

        Focus: Do similar commands follow similar patterns for skill activation?
      available_resources: []

claude_md_missing:
  description: "Project missing CLAUDE.md configuration file"
  scope: project_level
  context: "CLAUDE.md provides essential context for Claude Code about project structure and conventions. Missing this file reduces AI effectiveness."
  requires_project_context: true
  supported_clients:
    - claude-code
  phases:
    - name: check_file
      type: core:file_exists
      file_path: CLAUDE.md
      failure_message: "CLAUDE.md file is missing from project root"
      expected_behavior: "Project should have CLAUDE.md file documenting structure and conventions"

command_duplicate_dependencies:
  description: "Commands have redundant transitive skill dependencies"
  scope: project_level
  context: "Commands should only declare direct skill dependencies. Transitive dependencies are automatically included."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: mixed
    file_patterns:
      - .claude/commands/*.md
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
  phases:
    - name: check_duplicates
      type: core:dependency_duplicate
      description: "Check for redundant transitive dependencies in commands"
      failure_message: "Found redundant dependency: {duplicate_resource}"
      expected_behavior: "Commands should only declare direct dependencies, not transitive ones"
      params:
        resource_dirs:
          - .claude/commands
          - .claude/skills

skill_duplicate_dependencies:
  description: "Skills have redundant transitive skill dependencies"
  scope: project_level
  context: "Skills should only declare direct dependencies on other skills. Transitive dependencies are automatically included."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: skill
    file_patterns:
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
  phases:
    - name: check_duplicates
      type: core:dependency_duplicate
      description: "Check for redundant transitive dependencies in skills"
      failure_message: "Found redundant dependency: {duplicate_resource}"
      expected_behavior: "Skills should only declare direct dependencies, not transitive ones"
      params:
        resource_dirs:
          - .claude/skills

skill_filename_consistency:
  description: "Skill directories must contain SKILL.md (uppercase), not skill.md"
  scope: project_level
  context: "Consistent filename casing prevents confusion and ensures reliable skill loading across case-sensitive file systems."
  requires_project_context: true
  supported_clients:
    - claude-code
  phases:
    - name: check_skill_files
      type: core:file_exists
      file_path: .claude/skills/*/SKILL.md
      failure_message: "Found skill directory with skill.md (lowercase) instead of SKILL.md (uppercase)"
      expected_behavior: "All skill directories should contain SKILL.md (uppercase) as the main skill file"

skill_frontmatter_name_match:
  description: "Skill frontmatter name must match the skill directory name"
  scope: project_level
  context: "Mismatched skill names cause confusion and prevent proper skill activation in Claude Code."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: skill
    file_patterns:
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
  phases:
    - name: check_name_match
      type: prompt
      prompt: |
        Check if the skill's frontmatter `name` field matches its directory name.

        Directory path will be in the format: `.claude/skills/{directory-name}/SKILL.md`
        Extract the directory name from the path.

        CRITICAL ISSUES (report these):
        1. Frontmatter `name` field doesn't match directory name (case-sensitive)
        2. Directory name uses hyphens but frontmatter name uses underscores (or vice versa)
        3. Frontmatter name is completely different from directory name

        ACCEPTABLE (do NOT report):
        - Name matches exactly (e.g., directory "testing", frontmatter name: "testing")
        - Both use consistent naming convention (all lowercase, hyphens for multi-word)

        If there's a mismatch, report:
        - Directory name: {extracted from path}
        - Frontmatter name: {from YAML}
        - Explain the inconsistency
      available_resources:
        - skill

agent_duplicate_dependencies:
  description: "Agents have redundant transitive skill dependencies"
  scope: project_level
  context: "Agents should only declare direct skill dependencies. Transitive dependencies are automatically included."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: agent
    file_patterns:
      - .claude/agents/*.md
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
  phases:
    - name: check_duplicates
      type: core:dependency_duplicate
      description: "Check for redundant transitive dependencies in agents"
      failure_message: "Found redundant dependency: {duplicate_resource}"
      expected_behavior: "Agents should only declare direct dependencies, not transitive ones"
      params:
        resource_dirs:
          - .claude/agents
          - .claude/skills

command_broken_links:
  description: "Commands contain broken file references or links"
  scope: project_level
  context: "Commands must reference valid files and resources. Broken links cause confusion and errors."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: command
    file_patterns:
      - .claude/commands/*.md
    bundle_strategy: individual
  phases:
    - name: check_links
      type: core:markdown_link
      description: "Check for broken links in command documentation"
      failure_message: "Found broken links in commands"
      expected_behavior: "All file references and links should be valid"
      params:
        check_local_files: true
        check_external_urls: false
        # Skip common example/placeholder file patterns in documentation
        custom_skip_patterns:
          - '\.py'               # Python files in examples (test_parser.py, cli.py, etc.)
          - '\.yaml'             # YAML config files (config.yaml, drift.yaml, pre-commit-config.yaml, etc.)
          - '\.yml'              # YAML workflow files (test.yml, release.yml, etc.)
          - '\.cfg'              # Config files (setup.cfg, etc.)
          - 'CHANGELOG\.md'      # Changelog references in examples
          - 'github/workflows/'  # GitHub workflow directory references

skill_broken_links:
  description: "Skills contain broken file references or links"
  scope: project_level
  context: "Skills must reference valid files and resources. Broken links cause confusion and errors."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: skill
    file_patterns:
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
  phases:
    - name: check_links
      type: core:markdown_link
      description: "Check for broken links in skill documentation"
      failure_message: "Found broken links in skills"
      expected_behavior: "All file references and links should be valid"
      params:
        check_local_files: true
        check_external_urls: false
        # Skip common example/placeholder file patterns in documentation
        custom_skip_patterns:
          - '\.py'               # Python files in examples (test_parser.py, cli.py, etc.)
          - '\.yaml'             # YAML config files (config.yaml, drift.yaml, pre-commit-config.yaml, etc.)
          - '\.yml'              # YAML workflow files (test.yml, release.yml, etc.)
          - '\.cfg'              # Config files (setup.cfg, etc.)
          - 'CHANGELOG\.md'      # Changelog references in examples
          - 'github/workflows/'  # GitHub workflow directory references

agent_broken_links:
  description: "Agents contain broken file references or links"
  scope: project_level
  context: "Agents must reference valid files and resources. Broken links cause confusion and errors."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: agent
    file_patterns:
      - .claude/agents/*.md
    bundle_strategy: individual
  phases:
    - name: check_links
      type: core:markdown_link
      description: "Check for broken links in agent documentation"
      failure_message: "Found broken links in agents"
      expected_behavior: "All file references and links should be valid"
      params:
        check_local_files: true
        check_external_urls: false
        # Skip common example/placeholder file patterns in documentation
        custom_skip_patterns:
          - '\.py'               # Python files in examples (test_parser.py, cli.py, etc.)
          - '\.yaml'             # YAML config files (config.yaml, drift.yaml, pre-commit-config.yaml, etc.)
          - '\.yml'              # YAML workflow files (test.yml, release.yml, etc.)
          - '\.cfg'              # Config files (setup.cfg, etc.)
          - 'CHANGELOG\.md'      # Changelog references in examples
          - 'github/workflows/'  # GitHub workflow directory references

claude_skill_permissions:
  description: "Project skills missing from Claude Code settings permissions"
  scope: project_level
  context: "All skills in .claude/skills/ must have corresponding Skill() permission entries in .claude/settings.json. Missing permissions prevent skills from being used."
  requires_project_context: true
  supported_clients:
    - claude-code
  phases:
    - name: check_skill_permissions
      type: core:claude_skill_settings
      failure_message: "Skills missing from .claude/settings.json permissions.allow array"
      expected_behavior: "Every skill directory in .claude/skills/ should have a corresponding Skill(name) entry in .claude/settings.json"

claude_settings_duplicates:
  description: "Duplicate permission entries in Claude Code settings"
  scope: project_level
  context: "The .claude/settings.json permissions.allow array should not contain duplicate entries. Duplicates are unnecessary and can cause confusion."
  requires_project_context: true
  phases:
    - name: check_duplicate_permissions
      type: core:claude_settings_duplicates
      failure_message: "Duplicate permission entries found in .claude/settings.json"
      expected_behavior: "All permission entries in .claude/settings.json permissions.allow should be unique"

claude_mcp_permissions:
  description: "MCP servers missing from Claude Code settings permissions"
  scope: project_level
  context: "All MCP servers defined in .mcp.json must have corresponding MCP() permission entries in .claude/settings.json. Missing permissions prevent MCP servers from being used."
  requires_project_context: true
  phases:
    - name: check_mcp_permissions
      type: core:claude_mcp_permissions
      failure_message: "MCP servers missing from .claude/settings.json permissions.allow array"
      expected_behavior: "Every MCP server in .mcp.json should have a corresponding MCP(server-name) entry in .claude/settings.json"

claude_md_quality:
  description: "CLAUDE.md file violates quality best practices"
  scope: project_level
  context: "CLAUDE.md should be concise (<300 lines), use pointers instead of large code blocks (>20 lines), avoid linting rules (use automated tools), and provide essential project context."
  requires_project_context: false
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: mixed
    file_patterns:
      - CLAUDE.md
    bundle_strategy: individual
    resource_patterns: []
  phases:
    - name: check_line_count
      type: core:file_size
      file_path: CLAUDE.md
      max_count: 300
      failure_message: "CLAUDE.md exceeds 300 lines (best practice for concise context)"
      expected_behavior: "CLAUDE.md should be concise and under 300 lines"
    - name: content_quality
      type: prompt
      prompt: |
        Evaluate CLAUDE.md for content quality, code block length, and anti-patterns per Anthropic best practices.

        CRITICAL ISSUES (report these):

        **Conciseness**:
        1. Contains code blocks longer than 20 lines (count lines between ``` fences for each block)
        2. Large narrative paragraphs (>8 consecutive non-bullet lines) instead of bullet points

        **Completeness & Structure**:
        3. Missing ALL essential sections: tech stack, architecture, key commands/workflows, and coding standards
        4. No clear Markdown structure (no headers at all, completely unorganized)
        5. File is empty or only contains generic template boilerplate with no project-specific info

        **Anti-Patterns**:
        6. Contains detailed linting/formatting rules (e.g., "max line length 88", "import order: stdlib, third-party, local")
           → Should use automated tools (pyproject.toml, .flake8) NOT CLAUDE.md
        7. Embeds full API documentation (>30 lines of endpoint specs, schemas, or API reference)
           → Should link to API docs instead
        8. Session-specific instructions (e.g., "In this conversation..." or "For today's task...")
           → CLAUDE.md must be universal across all sessions

        ACCEPTABLE (do NOT report):
        - Code blocks under 20 lines
        - Brief narrative intros (2-3 sentences) before bullet lists
        - Variations in section naming ("Tech Stack" vs "Stack")
        - Brief sections (concise is good)
        - Missing optional sections like "Contributing"
        - Sections combined logically ("Commands & Workflows")
        - Brief style references ("We follow PEP 8, see pyproject.toml") ✓
        - Links to API docs ✓
        - General universal guidelines ✓
        - Brief code examples (2-3 lines) ✓

        EXAMPLES OF ACCEPTABLE:
        - 15-line code block ✓ (under 20)
        - "Stack: Python 3.11, FastAPI" ✓ (brief)
        - "Use black/flake8. Config in pyproject.toml" ✓ (pointer)
        - "API docs: https://example.com/api" ✓ (link)

        EXAMPLES TO FLAG:
        - 30-line code block ✗ (over 20)
        - "Linting: max-line-length=88, import order: stdlib, third-party..." ✗ (detailed rules)
        - 50-line API endpoint specification section ✗ (embedded docs)
        - "In this conversation, focus on auth module" ✗ (session-specific)
        - 12-line paragraph explaining commands ✗ (use bullets)
        - Multiple "TODO: add your..." with no actual content ✗ (template only)

        ONLY REPORT issues that significantly impact quality or violate best practices.
      available_resources: []
    - name: check_import_syntax
      type: prompt
      prompt: |
        Check CLAUDE.md for proper import syntax usage per Claude Code documentation.

        CRITICAL ISSUES (report these):
        1. Import syntax @path/to/file used INSIDE code blocks (```...```)
           → Imports must be outside code blocks to be processed
        2. Deeply nested imports exceeding 5 hops
           → Per docs: "imports should not exceed 5 hops in depth"

        ACCEPTABLE (do NOT report):
        - @path/to/file imports outside code blocks ✓ (correct usage)
        - Import depth ≤ 5 hops ✓ (within limits)
        - No imports used ✓ (imports are optional)
        - File paths in code examples (not using @ syntax) ✓

        REASONING: Claude Code's import feature has specific requirements:
        - Must be outside code blocks to be processed
        - Deep nesting (>5 hops) impacts performance

        Focus: Are imports used correctly if present?
      available_resources: []

claude_md_documentation_sync:
  description: "CLAUDE.md should mention all agents, key skills, and slash commands"
  scope: project_level
  context: "CLAUDE.md provides essential context about the project's Claude Code setup. Missing major agents, skills, or commands from the documentation creates confusion and prevents users from discovering available automation."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: mixed
    file_patterns:
      - CLAUDE.md
      - .claude/agents/*.md
      - .claude/skills/*/SKILL.md
      - .claude/commands/*.md
    bundle_strategy: collection
  phases:
    - name: check_component_documentation
      type: prompt
      prompt: |
        Check if CLAUDE.md documents the key Claude Code components in this project.

        You have access to:
        - CLAUDE.md content
        - All agent files (.claude/agents/*.md)
        - All skill files (.claude/skills/*/SKILL.md)
        - All command files (.claude/commands/*.md)

        CRITICAL ISSUES (report these):
        1. CLAUDE.md doesn't mention ANY agents (should list all agents in .claude/agents/)
        2. CLAUDE.md doesn't mention ANY slash commands (should document key commands from .claude/commands/)
        3. CLAUDE.md completely omits the Claude Code setup section (no .claude/ mention at all)

        ACCEPTABLE (do NOT report):
        - CLAUDE.md lists all agents ✓
        - CLAUDE.md documents major commands (doesn't need every single one, but key workflows) ✓
        - CLAUDE.md mentions key skills (doesn't need exhaustive list, just important ones) ✓
        - CLAUDE.md explains where to find more detail (.claude/ directory structure) ✓
        - Some minor or internal-only commands omitted (acceptable)

        EXAMPLES:

        GOOD (do NOT report):
        - Lists all 3 agents: cicd, developer, qa ✓
        - Documents key commands: /test, /lint, /full-check, /create-pr ✓
        - Mentions major skills: testing, linting, code-review ✓

        BAD (report these):
        - Has 4 agents but only lists 3 ✗ (missing documentation agent)
        - No commands documented anywhere ✗ (users can't discover them)
        - No mention of .claude/ setup at all ✗ (missing context)

        Focus: Are major components discoverable through CLAUDE.md?
      available_resources: []

agent_frontmatter:
  description: "Agent files missing or have invalid YAML frontmatter"
  scope: project_level
  context: "Agent files must have valid YAML frontmatter with required fields (name, description, model) to work properly in Claude Code."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: agent
    file_patterns:
      - .claude/agents/*.md
    bundle_strategy: individual
  phases:
    - name: check_frontmatter
      type: core:yaml_frontmatter
      params:
        required_fields:
          - name
          - description
          - model
        schema:
          type: object
          properties:
            name:
              type: string
              pattern: "^[a-z][a-z0-9-]*$"
              description: "Agent name must be lowercase with hyphens"
            description:
              type: string
              minLength: 10
              description: "Agent description must be at least 10 characters"
            model:
              type: string
              enum: ["sonnet", "opus", "haiku", "inherit"]
              description: "Model must be one of: sonnet, opus, haiku, inherit"
            skills:
              type: array
              items:
                type: string
              description: "Optional list of skill names"
            tools:
              type: array
              items:
                type: string
              description: "Optional list of tool names"
          required:
            - name
            - description
            - model
      failure_message: "Agent file has invalid or missing YAML frontmatter"
      expected_behavior: "Agent files should have valid YAML frontmatter with name, description, and model fields (model must be: sonnet, opus, haiku, or inherit)"

command_frontmatter:
  description: "Command files missing or have invalid YAML frontmatter"
  scope: project_level
  context: "Command files must have valid YAML frontmatter with required fields (description) to work properly in Claude Code."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: command
    file_patterns:
      - .claude/commands/*.md
    bundle_strategy: individual
  phases:
    - name: check_frontmatter
      type: core:yaml_frontmatter
      params:
        required_fields:
          - description
        schema:
          type: object
          properties:
            description:
              type: string
              minLength: 10
              description: "Command description must be at least 10 characters"
            skills:
              type: array
              items:
                type: string
              description: "Optional list of skill names to activate"
            argument-hint:
              type: string
              description: "Optional hint for command arguments during tab-completion"
          required:
            - description
      failure_message: "Command file has invalid or missing YAML frontmatter"
      expected_behavior: "Command files should have valid YAML frontmatter with a description field"
    - name: check_parameter_hints
      type: prompt
      prompt: |
        Check if command uses parameters but is missing argument-hint.

        CRITICAL ISSUES (report these):
        1. Command content includes $ARGUMENTS, $1, $2, $3, etc. but frontmatter has NO argument-hint field
        2. Command clearly expects parameters (mentions "<parameter>" or "pass <value>") but no argument-hint

        ACCEPTABLE (do NOT report):
        - Command has argument-hint field for parameters ✓
        - Command doesn't use any parameters (no $ARGUMENTS, $1, etc.) ✓
        - Command references files with @ syntax but doesn't take parameters ✓

        REASONING: argument-hint helps users during tab-completion. If a command takes parameters,
        it should guide users on what to provide.

        Focus: Does the command take parameters but lack user guidance?
      available_resources:
        - command
    - name: check_skill_references
      type: prompt
      prompt: |
        If the command frontmatter declares skills array, verify those skills exist.

        You can request skill files to check if they exist.

        CRITICAL ISSUES (report these):
        - Command references a skill in frontmatter that doesn't exist in .claude/skills/

        ACCEPTABLE (do NOT report):
        - All referenced skills exist ✓
        - Command doesn't declare skills array ✓
        - Skills array is empty ✓

        Focus: Are skill references valid?
      available_resources:
        - command
        - skill

agent_tools_format:
  description: "Agent tools must use comma-separated format, not YAML list"
  scope: project_level
  context: "Claude Code requires agent tools to be comma-separated on one line (e.g., 'tools: Read, Write, Edit') not YAML list format (tools:\\n  - Read). YAML list format causes tools to not work."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: agent
    file_patterns:
      - .claude/agents/*.md
    bundle_strategy: individual
  phases:
    - name: check_tools_comma_separated
      type: core:regex_match
      description: "Validate tools field uses comma-separated format on single line"
      params:
        pattern: '^tools:\s+[A-Za-z][\w_]+(?:,\s*[A-Za-z][\w_]+)*\s*$'
        flags: 8
      failure_message: "Agent tools field uses YAML list format (- Read) instead of comma-separated format"
      expected_behavior: "Tools should be comma-separated on one line: 'tools: Read, Write, Edit, Grep, Glob' not YAML list with dashes"

skill_circular_dependencies:
  description: "Skills have circular dependency cycles"
  scope: project_level
  context: "Circular dependencies in skills create infinite loops and prevent proper skill loading. Each skill's dependency graph must be acyclic."
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: skill
    file_patterns:
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
  phases:
    - name: check_cycles
      type: core:circular_dependencies
      description: "Check for circular dependencies in skill dependency graphs"
      failure_message: "Circular dependency detected: {circular_path}"
      expected_behavior: "Skills should not have circular dependency cycles"
      params:
        resource_dirs:
          - .claude/skills

# Claude Code Dependency Validation Examples
command_circular_dependencies:
  description: "Commands must not have circular skill dependencies"
  scope: project_level
  context: "Circular dependencies cause loading failures and maintenance issues"
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: command
    file_patterns:
      - .claude/commands/*.md
    bundle_strategy: individual
  phases:
    - name: check_circular_deps
      type: core:claude_circular_dependencies
      description: "Detect circular dependency cycles"
      params:
        resource_dirs:
          - .claude/commands
          - .claude/skills
          - .claude/agents
      failure_message: "Circular dependency detected: {circular_path}"
      expected_behavior: "Commands should not have circular skill dependencies"

skill_max_depth:
  description: "Skill dependency chains should not exceed maximum depth"
  scope: project_level
  context: "Deep dependency chains are hard to maintain and slow to load"
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: skill
    file_patterns:
      - .claude/skills/*/SKILL.md
    bundle_strategy: individual
  phases:
    - name: check_depth
      type: core:claude_max_dependency_depth
      description: "Ensure dependencies don't exceed maximum depth"
      params:
        max_depth: 3
        resource_dirs:
          - .claude/commands
          - .claude/skills
          - .claude/agents
      failure_message: "Dependency depth {actual_depth} exceeds maximum {max_depth}"
      expected_behavior: "Skill dependencies should not exceed depth of 3"

agent_duplicate_dependencies_claude:
  description: "Agents should only declare direct skill dependencies (Claude validator)"
  scope: project_level
  context: "Transitive dependencies are automatically included by Claude Code"
  requires_project_context: true
  supported_clients:
    - claude-code
  document_bundle:
    bundle_type: agent
    file_patterns:
      - .claude/agents/*.md
    bundle_strategy: individual
  phases:
    - name: check_duplicates
      type: core:claude_dependency_duplicate
      description: "Check for redundant transitive dependencies"
      params:
        resource_dirs:
          - .claude/commands
          - .claude/skills
          - .claude/agents
      failure_message: "Found redundant dependency: {duplicate_resource}"
      expected_behavior: "Agents should only declare direct dependencies, not transitive ones"
